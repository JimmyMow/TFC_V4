<div class="posts-container">
  <div class='home-title'>
    <h1>FansChallenge: Talk sports with the world.</h1>
    <h2><%= link_to "Most popular posts", posts_url, :class => 'header_link', :id => 'most_popular' %> | <%= link_to "Most recent posts", posts_url(new_post: 'true'), :class => 'header_link', :id => 'most_recent' %></h2>
    <%= link_to "Add a post", new_post_url %>
  </div>
  <% @posts.each do |post| %>
    <div class='post'>
      <section>
        <p class='post-title'><%= link_to post.title, post_url(post.id) %></p>
        <p class='post-details'>created <%= time_ago_in_words(post.created_at) %> ago by <%= link_to post.user.username, user_url(post.user.id) %></p>
      </section>
      <aside>
          <p class='score'><%= pluralize(post.votes_for, 'upvote') %> | <%= pluralize(post.votes_against, 'downvote') %></p>
        <% if current_user.present? && !current_user.voted_on?(post) %>
          <p class='voting'><%= link_to "upvote", upvote_post_url(post.id), :method => 'post' %> | <%= link_to 'downvote', downvote_post_url(post.id), :method => 'post' %></p>
        <% end %>

        <% if current_user && current_user.oauth_token %>
          <p><%= link_to "Tweet this", tweet_post_url(post.id, message: post.title), :method => 'post' %></p>
        <% elsif current_user %>
          <%= link_to "Tweet this", user_omniauth_authorize_path(:twitter, user_id: current_user.id, tweet: 'yes', message: post.title, post_id: post.id), :alert => 'First you must authorize your twitter.' %>
        <% end %>
      </aside>
    </div>
  <% end %>
  <%= paginate @posts if params[:new_post] %>
</div>
